pipeline {
  agent any
  tools {
    maven 'Maven'
  }
  stages {
    stage ('Artifactory setup'){
        steps {
          rtServer (
            id: 'sndevops-jfrog',
            url: 'https://sndevops.jfrog.io',
            credentialsId: 'jfrog-token'
          )
          rtMavenDeployer(
            id: "maven-deployer1",
            serverId: "sndevops-jfrog",
            releaseRepo: "libs-release",
            snapshotRepo: "libs-release"
          )
        }
    }
    stage('Build') {
      steps {
        echo 'Building..'
       
        rtMavenRun (
          tool: 'Maven',
          pom: 'pom.xml',
          goals: 'install',
          opts: '-Dartifactory.publish.artifacts=true -Dartifactory.publish.buildInfo=true',
          deployerId: 'maven-deployer1'
        )
        echo 'Build done..'
      }
    }
    stage('Test') {
      steps {

         echo 'Publish start..'
         rtPublishBuildInfo(serverId: "sndevops-jfrog")
         echo 'Publish done..'
      }
    }
  }
}
